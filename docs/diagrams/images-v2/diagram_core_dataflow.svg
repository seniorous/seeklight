<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="950" height="580" viewBox="0 0 950 580">
  <defs>
    <linearGradient id="inputGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#3498DB"/><stop offset="100%" style="stop-color:#2980B9"/>
    </linearGradient>
    <linearGradient id="processGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#F4A261"/><stop offset="100%" style="stop-color:#E76F51"/>
    </linearGradient>
    <linearGradient id="storeGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#2A9D8F"/><stop offset="100%" style="stop-color:#1A8D7F"/>
    </linearGradient>
    <linearGradient id="outputGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#9B59B6"/><stop offset="100%" style="stop-color:#8E44AD"/>
    </linearGradient>
    <marker id="arrowHead" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
      <path d="M0,0 L8,4 L0,8 Z" fill="#7F8C8D"/>
    </marker>
    <filter id="shadowDF"><feDropShadow dx="1" dy="2" stdDeviation="2" flood-opacity="0.1"/></filter>
  </defs>
  
  <rect width="950" height="580" fill="#FAFBFC"/>
  
  <!-- 标题 -->
  <text x="475" y="30" text-anchor="middle" font-family="SimHei, sans-serif" font-size="20" font-weight="bold" fill="#2C3E50">拾光系统数据流图</text>
  <text x="475" y="52" text-anchor="middle" font-family="SimSun, serif" font-size="12" fill="#7F8C8D">图片导入 → 智能处理 → 存储索引 → 语义检索</text>
  
  <!-- 阶段1: 图片输入 -->
  <g transform="translate(30, 80)">
    <rect x="0" y="0" width="180" height="200" rx="8" fill="#FFFFFF" stroke="#3498DB" stroke-width="2" filter="url(#shadowDF)"/>
    <rect x="0" y="0" width="180" height="35" rx="8 8 0 0" fill="url(#inputGrad)"/>
    <text x="90" y="23" text-anchor="middle" font-family="SimHei, sans-serif" font-size="12" fill="white" font-weight="bold">1. 图片输入</text>
    
    <g transform="translate(15, 50)">
      <rect x="0" y="0" width="150" height="35" rx="4" fill="#E3F2FD"/>
      <text x="75" y="22" text-anchor="middle" font-family="SimSun, serif" font-size="10" fill="#1565C0">截图监听触发</text>
    </g>
    <g transform="translate(15, 95)">
      <rect x="0" y="0" width="150" height="35" rx="4" fill="#E3F2FD"/>
      <text x="75" y="22" text-anchor="middle" font-family="SimSun, serif" font-size="10" fill="#1565C0">手动批量导入</text>
    </g>
    <g transform="translate(15, 140)">
      <rect x="0" y="0" width="150" height="35" rx="4" fill="#E3F2FD"/>
      <text x="75" y="22" text-anchor="middle" font-family="SimSun, serif" font-size="10" fill="#1565C0">相册同步扫描</text>
    </g>
  </g>
  
  <!-- 箭头1 -->
  <line x1="220" y1="180" x2="260" y2="180" stroke="#7F8C8D" stroke-width="2" marker-end="url(#arrowHead)"/>
  
  <!-- 阶段2: 智能处理 -->
  <g transform="translate(270, 80)">
    <rect x="0" y="0" width="200" height="200" rx="8" fill="#FFFFFF" stroke="#E76F51" stroke-width="2" filter="url(#shadowDF)"/>
    <rect x="0" y="0" width="200" height="35" rx="8 8 0 0" fill="url(#processGrad)"/>
    <text x="100" y="23" text-anchor="middle" font-family="SimHei, sans-serif" font-size="12" fill="white" font-weight="bold">2. 智能处理</text>
    
    <g transform="translate(15, 50)">
      <rect x="0" y="0" width="170" height="28" rx="4" fill="#FFF3E0"/>
      <text x="85" y="18" text-anchor="middle" font-family="SimSun, serif" font-size="10" fill="#E65100">L1: 二维码/OCR/分类</text>
    </g>
    <g transform="translate(15, 85)">
      <rect x="0" y="0" width="170" height="28" rx="4" fill="#FFF3E0"/>
      <text x="85" y="18" text-anchor="middle" font-family="SimSun, serif" font-size="10" fill="#E65100">L2: 结构化信息提取</text>
    </g>
    <g transform="translate(15, 120)">
      <rect x="0" y="0" width="170" height="28" rx="4" fill="#FFF3E0"/>
      <text x="85" y="18" text-anchor="middle" font-family="SimSun, serif" font-size="10" fill="#E65100">L3: VLM语义描述</text>
    </g>
    <g transform="translate(15, 155)">
      <rect x="0" y="0" width="170" height="28" rx="4" fill="#FFEBEE"/>
      <text x="85" y="18" text-anchor="middle" font-family="SimSun, serif" font-size="10" fill="#C62828">敏感内容检测</text>
    </g>
  </g>
  
  <!-- 箭头2 -->
  <line x1="480" y1="180" x2="520" y2="180" stroke="#7F8C8D" stroke-width="2" marker-end="url(#arrowHead)"/>
  
  <!-- 阶段3: 存储索引 -->
  <g transform="translate(530, 80)">
    <rect x="0" y="0" width="180" height="200" rx="8" fill="#FFFFFF" stroke="#2A9D8F" stroke-width="2" filter="url(#shadowDF)"/>
    <rect x="0" y="0" width="180" height="35" rx="8 8 0 0" fill="url(#storeGrad)"/>
    <text x="90" y="23" text-anchor="middle" font-family="SimHei, sans-serif" font-size="12" fill="white" font-weight="bold">3. 存储索引</text>
    
    <g transform="translate(15, 50)">
      <rect x="0" y="0" width="150" height="35" rx="4" fill="#E0F2F1"/>
      <text x="75" y="15" text-anchor="middle" font-family="SimSun, serif" font-size="10" fill="#00695C">短期记忆</text>
      <text x="75" y="30" text-anchor="middle" font-family="Arial" font-size="9" fill="#00897B">ImageMemory</text>
    </g>
    <g transform="translate(15, 95)">
      <rect x="0" y="0" width="150" height="35" rx="4" fill="#E0F2F1"/>
      <text x="75" y="15" text-anchor="middle" font-family="SimSun, serif" font-size="10" fill="#00695C">向量索引</text>
      <text x="75" y="30" text-anchor="middle" font-family="Arial" font-size="9" fill="#00897B">HNSW + PQ</text>
    </g>
    <g transform="translate(15, 140)">
      <rect x="0" y="0" width="150" height="35" rx="4" fill="#FCE4EC"/>
      <text x="75" y="15" text-anchor="middle" font-family="SimSun, serif" font-size="10" fill="#AD1457">隐私保险箱</text>
      <text x="75" y="30" text-anchor="middle" font-family="Arial" font-size="9" fill="#C2185B">加密隔离</text>
    </g>
  </g>
  
  <!-- 箭头3 -->
  <line x1="720" y1="180" x2="760" y2="180" stroke="#7F8C8D" stroke-width="2" marker-end="url(#arrowHead)"/>
  
  <!-- 阶段4: 检索输出 -->
  <g transform="translate(770, 80)">
    <rect x="0" y="0" width="150" height="200" rx="8" fill="#FFFFFF" stroke="#9B59B6" stroke-width="2" filter="url(#shadowDF)"/>
    <rect x="0" y="0" width="150" height="35" rx="8 8 0 0" fill="url(#outputGrad)"/>
    <text x="75" y="23" text-anchor="middle" font-family="SimHei, sans-serif" font-size="12" fill="white" font-weight="bold">4. 检索输出</text>
    
    <g transform="translate(15, 50)">
      <rect x="0" y="0" width="120" height="35" rx="4" fill="#F3E5F5"/>
      <text x="60" y="22" text-anchor="middle" font-family="SimSun, serif" font-size="10" fill="#7B1FA2">语义匹配结果</text>
    </g>
    <g transform="translate(15, 95)">
      <rect x="0" y="0" width="120" height="35" rx="4" fill="#F3E5F5"/>
      <text x="60" y="22" text-anchor="middle" font-family="SimSun, serif" font-size="10" fill="#7B1FA2">事件聚合结果</text>
    </g>
    <g transform="translate(15, 140)">
      <rect x="0" y="0" width="120" height="35" rx="4" fill="#F3E5F5"/>
      <text x="60" y="22" text-anchor="middle" font-family="SimSun, serif" font-size="10" fill="#7B1FA2">智能建议推送</text>
    </g>
  </g>
  
  <!-- 层次化记忆系统（底部） -->
  <g transform="translate(270, 320)">
    <rect x="0" y="0" width="440" height="240" rx="10" fill="#F0F7F5" stroke="#2A9D8F" stroke-width="2" filter="url(#shadowDF)"/>
    <rect x="0" y="0" width="440" height="35" rx="10 10 0 0" fill="url(#storeGrad)"/>
    <text x="220" y="23" text-anchor="middle" font-family="SimHei, sans-serif" font-size="13" fill="white" font-weight="bold">层次化记忆系统 Hierarchical Memory</text>
    
    <!-- 短期→长期 -->
    <g transform="translate(20, 50)">
      <rect x="0" y="0" width="125" height="80" rx="6" fill="#E8F5E9" stroke="#4CAF50" stroke-width="1"/>
      <text x="62" y="20" text-anchor="middle" font-family="SimHei, sans-serif" font-size="11" fill="#2E7D32" font-weight="bold">短期记忆</text>
      <text x="62" y="40" text-anchor="middle" font-family="SimSun, serif" font-size="9" fill="#455A64">单图描述</text>
      <text x="62" y="55" text-anchor="middle" font-family="SimSun, serif" font-size="9" fill="#455A64">语义向量</text>
      <text x="62" y="70" text-anchor="middle" font-family="Arial" font-size="8" fill="#4CAF50">TRL 7</text>
    </g>
    
    <text x="160" y="95" font-family="Arial" font-size="14" fill="#2A9D8F">→</text>
    <text x="155" y="115" font-family="SimSun, serif" font-size="8" fill="#7F8C8D">Reflection</text>
    
    <g transform="translate(175, 50)">
      <rect x="0" y="0" width="125" height="80" rx="6" fill="#FFF3E0" stroke="#FF9800" stroke-width="1"/>
      <text x="62" y="20" text-anchor="middle" font-family="SimHei, sans-serif" font-size="11" fill="#E65100" font-weight="bold">长期记忆</text>
      <text x="62" y="40" text-anchor="middle" font-family="SimSun, serif" font-size="9" fill="#455A64">高级事实推断</text>
      <text x="62" y="55" text-anchor="middle" font-family="SimSun, serif" font-size="9" fill="#455A64">事件关联</text>
      <text x="62" y="70" text-anchor="middle" font-family="Arial" font-size="8" fill="#FF9800">TRL 3</text>
    </g>
    
    <text x="315" y="95" font-family="Arial" font-size="14" fill="#2A9D8F">→</text>
    <text x="305" y="115" font-family="SimSun, serif" font-size="8" fill="#7F8C8D">行为观察</text>
    
    <g transform="translate(330, 50)">
      <rect x="0" y="0" width="90" height="80" rx="6" fill="#F3E5F5" stroke="#9C27B0" stroke-width="1"/>
      <text x="45" y="20" text-anchor="middle" font-family="SimHei, sans-serif" font-size="11" fill="#7B1FA2" font-weight="bold">隐式记忆</text>
      <text x="45" y="40" text-anchor="middle" font-family="SimSun, serif" font-size="9" fill="#455A64">用户偏好</text>
      <text x="45" y="55" text-anchor="middle" font-family="SimSun, serif" font-size="9" fill="#455A64">EMA更新</text>
      <text x="45" y="70" text-anchor="middle" font-family="Arial" font-size="8" fill="#9C27B0">TRL 3</text>
    </g>
    
    <!-- Reflection触发条件 -->
    <g transform="translate(20, 145)">
      <rect x="0" y="0" width="400" height="80" rx="6" fill="#FAFAFA" stroke="#E0E0E0" stroke-width="1"/>
      <text x="200" y="20" text-anchor="middle" font-family="SimHei, sans-serif" font-size="11" fill="#2C3E50" font-weight="bold">Reflection触发条件</text>
      <text x="15" y="42" font-family="SimSun, serif" font-size="9" fill="#455A64">• 单次导入 &gt; 50张图片</text>
      <text x="15" y="58" font-family="SimSun, serif" font-size="9" fill="#455A64">• 地理位置变化 &gt; 50km</text>
      <text x="200" y="42" font-family="SimSun, serif" font-size="9" fill="#455A64">• 场景信息熵 &lt; 0.5</text>
      <text x="200" y="58" font-family="SimSun, serif" font-size="9" fill="#455A64">• 设备空闲 + 充电状态</text>
      <text x="200" y="74" text-anchor="middle" font-family="Arial" font-size="8" fill="#7F8C8D">WorkManager后台调度</text>
    </g>
  </g>
</svg>